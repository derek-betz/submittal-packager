<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Submittal Validation Report</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    .status-ok { color: #2e7d32; }
    .status-warn { color: #f9a825; }
    .status-error { color: #c62828; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; }
    th { background-color: #f5f5f5; }
    details { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>Submittal Validation Report</h1>
  <p><strong>Project:</strong> {{ project.designation }} – {{ project.project_name }}</p>
  <p><strong>Route:</strong> {{ project.route }}</p>
  <p><strong>Stage:</strong> {{ stage }}</p>
  <p><strong>Consultant:</strong> {{ project.consultant }}</p>
  <p><strong>Primary Contact:</strong> {{ project.contact }}</p>
  <p><strong>Generated:</strong> {{ generated_at }}</p>

  <section>
    <h2>Summary</h2>
    <p class="status-ok">Files: {{ package_overview.totals.files if package_overview.totals is defined else totals.files }}</p>
    <p class="status-ok">Pages: {{ package_overview.totals.pages if package_overview.totals is defined else totals.pages }}</p>
    <p class="status-ok">Checksum Algorithm: {{ checksum_algo }}</p>
  </section>

  <section>
    <h2>Certification Statement</h2>
    <p>
      The consultant of record certifies that this package aligns with the Indiana Design Manual
      submittal checklist and contains all materials required for INDOT review.
    </p>
  </section>

  <section>
    <h2>Messages</h2>
    <details open>
      <summary class="status-error">Errors ({{ errors|length }})</summary>
      <ul>
      {% for err in errors %}
        <li>{{ err }}</li>
      {% endfor %}
      </ul>
    </details>
    <details open>
      <summary class="status-warn">Warnings ({{ warnings|length }})</summary>
      <ul>
      {% for warn in warnings %}
        <li>{{ warn }}</li>
      {% endfor %}
      </ul>
    </details>
  </section>

  <section>
    <h2>Packaging Layout</h2>
    <p><strong>ZIP Root Folder:</strong> {{ package_overview.root or 'Not Set' }}</p>
    <table>
      <thead>
        <tr>
          <th>Folder</th>
          <th>Description</th>
          <th>Files</th>
          <th>Pages</th>
        </tr>
      </thead>
      <tbody>
      {% for folder in package_overview.folders %}
        <tr>
          <td>{{ folder.name }}</td>
          <td>{{ folder.description or '' }}</td>
          <td>{{ folder.summary.files }}</td>
          <td>{{ folder.summary.pages }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </section>

  <section>
    <h2>Generated Administrative Artifacts</h2>
    {% if package_overview.generated %}
    <ul>
    {% for artifact in package_overview.generated %}
      <li>{{ artifact.label }} – {{ artifact.package_path }}</li>
    {% endfor %}
    </ul>
    {% else %}
    <p>No additional administrative artifacts were generated for this package.</p>
    {% endif %}
  </section>

  <section>
    <h2>Discipline Summary</h2>
    <table>
      <thead>
        <tr>
          <th>Discipline</th>
          <th>Files</th>
          <th>Pages</th>
        </tr>
      </thead>
      <tbody>
      {% for discipline, stats in package_overview.discipline_summary.items() %}
        <tr>
          <td>{{ discipline }}</td>
          <td>{{ stats.files }}</td>
          <td>{{ stats.pages }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </section>

  <section>
    <h2>Files</h2>
    <table>
      <thead>
        <tr>
          <th>File</th>
          <th>Pages</th>
          <th>Discipline</th>
          <th>Sheet Type</th>
          <th>Sheets</th>
          <th>Checksum</th>
          <th>Package Path</th>
        </tr>
      </thead>
      <tbody>
      {% for item in files %}
        <tr>
          <td>{{ item.relative_path }}</td>
          <td>{{ item.pages }}</td>
          <td>{{ item.discipline or '' }}</td>
          <td>{{ item.sheet_type or '' }}</td>
          <td>{{ item.sheet_start }}{% if item.sheet_end %}-{{ item.sheet_end }}{% endif %}</td>
          <td>{{ item.checksum }} ({{ item.checksum_algorithm }})</td>
          <td>{{ item.package_path or '' }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
</body>
</html>
